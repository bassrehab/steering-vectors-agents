
Tool Restraint Vector Extraction

Model: mistralai/Mistral-7B-Instruct-v0.2
Device: mps
Output: data/vectors/tool_restraint_mistral_7b_instruct_v0.2

Loading model...
`torch_dtype` is deprecated! Use `dtype` instead!
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:02<00:05,  2.87s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:05<00:02,  2.64s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:07<00:00,  2.48s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:07<00:00,  2.55s/it]
Target layers: [14, 16, 18, 20]

Loading contrast pairs...
Loaded 41 contrast pairs

Extracting vectors...

Extracting layer 14...
Layer 14:   0%|          | 0/41 [00:00<?, ?it/s]Layer 14:   2%|▏         | 1/41 [00:00<00:36,  1.09it/s]Layer 14:   5%|▍         | 2/41 [00:01<00:25,  1.52it/s]Layer 14:   7%|▋         | 3/41 [00:01<00:20,  1.85it/s]Layer 14:  10%|▉         | 4/41 [00:02<00:17,  2.12it/s]Layer 14:  12%|█▏        | 5/41 [00:02<00:15,  2.31it/s]Layer 14:  15%|█▍        | 6/41 [00:02<00:14,  2.49it/s]Layer 14:  17%|█▋        | 7/41 [00:03<00:13,  2.58it/s]Layer 14:  20%|█▉        | 8/41 [00:03<00:12,  2.66it/s]Layer 14:  22%|██▏       | 9/41 [00:03<00:11,  2.73it/s]Layer 14:  24%|██▍       | 10/41 [00:04<00:11,  2.73it/s]Layer 14:  27%|██▋       | 11/41 [00:04<00:10,  2.82it/s]Layer 14:  29%|██▉       | 12/41 [00:05<00:12,  2.40it/s]Layer 14:  32%|███▏      | 13/41 [00:05<00:10,  2.57it/s]Layer 14:  34%|███▍      | 14/41 [00:05<00:10,  2.66it/s]Layer 14:  37%|███▋      | 15/41 [00:06<00:09,  2.64it/s]Layer 14:  39%|███▉      | 16/41 [00:06<00:09,  2.65it/s]Layer 14:  41%|████▏     | 17/41 [00:06<00:08,  2.72it/s]Layer 14:  44%|████▍     | 18/41 [00:07<00:08,  2.71it/s]Layer 14:  46%|████▋     | 19/41 [00:07<00:07,  2.77it/s]Layer 14:  49%|████▉     | 20/41 [00:08<00:08,  2.61it/s]Layer 14:  51%|█████     | 21/41 [00:08<00:08,  2.43it/s]Layer 14:  54%|█████▎    | 22/41 [00:08<00:07,  2.54it/s]Layer 14:  56%|█████▌    | 23/41 [00:09<00:06,  2.60it/s]Layer 14:  59%|█████▊    | 24/41 [00:09<00:06,  2.49it/s]Layer 14:  61%|██████    | 25/41 [00:10<00:06,  2.59it/s]Layer 14:  63%|██████▎   | 26/41 [00:10<00:05,  2.58it/s]Layer 14:  66%|██████▌   | 27/41 [00:10<00:05,  2.51it/s]Layer 14:  68%|██████▊   | 28/41 [00:11<00:04,  2.63it/s]Layer 14:  71%|███████   | 29/41 [00:11<00:05,  2.23it/s]Layer 14:  73%|███████▎  | 30/41 [00:12<00:05,  2.20it/s]Layer 14:  76%|███████▌  | 31/41 [00:12<00:04,  2.17it/s]Layer 14:  78%|███████▊  | 32/41 [00:13<00:03,  2.34it/s]Layer 14:  80%|████████  | 33/41 [00:13<00:03,  2.51it/s]Layer 14:  83%|████████▎ | 34/41 [00:13<00:02,  2.68it/s]Layer 14:  85%|████████▌ | 35/41 [00:14<00:02,  2.72it/s]Layer 14:  88%|████████▊ | 36/41 [00:14<00:01,  2.50it/s]Layer 14:  90%|█████████ | 37/41 [00:14<00:01,  2.61it/s]Layer 14:  93%|█████████▎| 38/41 [00:15<00:01,  2.68it/s]Layer 14:  95%|█████████▌| 39/41 [00:15<00:00,  2.73it/s]Layer 14:  98%|█████████▊| 40/41 [00:15<00:00,  2.78it/s]Layer 14: 100%|██████████| 41/41 [00:16<00:00,  2.71it/s]Layer 14: 100%|██████████| 41/41 [00:16<00:00,  2.50it/s]
  Vector norm: 2.2344

Extracting layer 16...
Layer 16:   0%|          | 0/41 [00:00<?, ?it/s]Layer 16:   2%|▏         | 1/41 [00:00<00:05,  7.74it/s]Layer 16:   5%|▍         | 2/41 [00:00<00:09,  4.10it/s]Layer 16:   7%|▋         | 3/41 [00:00<00:10,  3.52it/s]Layer 16:  10%|▉         | 4/41 [00:01<00:11,  3.24it/s]Layer 16:  12%|█▏        | 5/41 [00:01<00:11,  3.13it/s]Layer 16:  15%|█▍        | 6/41 [00:01<00:11,  3.09it/s]Layer 16:  17%|█▋        | 7/41 [00:02<00:11,  3.08it/s]Layer 16:  20%|█▉        | 8/41 [00:02<00:10,  3.04it/s]Layer 16:  22%|██▏       | 9/41 [00:02<00:10,  3.02it/s]Layer 16:  24%|██▍       | 10/41 [00:03<00:10,  3.01it/s]Layer 16:  27%|██▋       | 11/41 [00:03<00:09,  3.01it/s]Layer 16:  29%|██▉       | 12/41 [00:03<00:10,  2.85it/s]Layer 16:  32%|███▏      | 13/41 [00:04<00:09,  2.90it/s]Layer 16:  34%|███▍      | 14/41 [00:04<00:09,  2.93it/s]Layer 16:  37%|███▋      | 15/41 [00:04<00:08,  2.91it/s]Layer 16:  39%|███▉      | 16/41 [00:05<00:08,  2.87it/s]Layer 16:  41%|████▏     | 17/41 [00:05<00:08,  2.91it/s]Layer 16:  44%|████▍     | 18/41 [00:05<00:07,  2.90it/s]Layer 16:  46%|████▋     | 19/41 [00:06<00:07,  2.97it/s]Layer 16:  49%|████▉     | 20/41 [00:06<00:07,  2.96it/s]Layer 16:  51%|█████     | 21/41 [00:06<00:06,  2.90it/s]Layer 16:  54%|█████▎    | 22/41 [00:07<00:06,  2.90it/s]Layer 16:  56%|█████▌    | 23/41 [00:07<00:06,  2.96it/s]Layer 16:  59%|█████▊    | 24/41 [00:07<00:05,  3.01it/s]Layer 16:  61%|██████    | 25/41 [00:08<00:05,  3.01it/s]Layer 16:  63%|██████▎   | 26/41 [00:08<00:05,  2.87it/s]Layer 16:  66%|██████▌   | 27/41 [00:09<00:05,  2.75it/s]Layer 16:  68%|██████▊   | 28/41 [00:09<00:04,  2.80it/s]Layer 16:  71%|███████   | 29/41 [00:09<00:04,  2.70it/s]Layer 16:  73%|███████▎  | 30/41 [00:10<00:04,  2.50it/s]Layer 16:  76%|███████▌  | 31/41 [00:10<00:03,  2.61it/s]Layer 16:  78%|███████▊  | 32/41 [00:10<00:03,  2.71it/s]Layer 16:  80%|████████  | 33/41 [00:11<00:02,  2.79it/s]Layer 16:  83%|████████▎ | 34/41 [00:11<00:02,  2.89it/s]Layer 16:  85%|████████▌ | 35/41 [00:11<00:02,  2.90it/s]Layer 16:  88%|████████▊ | 36/41 [00:12<00:01,  2.95it/s]Layer 16:  90%|█████████ | 37/41 [00:12<00:01,  2.95it/s]Layer 16:  93%|█████████▎| 38/41 [00:12<00:01,  2.95it/s]Layer 16:  95%|█████████▌| 39/41 [00:13<00:00,  2.95it/s]Layer 16:  98%|█████████▊| 40/41 [00:13<00:00,  2.94it/s]Layer 16: 100%|██████████| 41/41 [00:13<00:00,  2.84it/s]Layer 16: 100%|██████████| 41/41 [00:13<00:00,  2.93it/s]
  Vector norm: 2.9375

Extracting layer 18...
Layer 18:   0%|          | 0/41 [00:00<?, ?it/s]Layer 18:   2%|▏         | 1/41 [00:00<00:05,  7.36it/s]Layer 18:   5%|▍         | 2/41 [00:00<00:09,  3.98it/s]Layer 18:   7%|▋         | 3/41 [00:00<00:10,  3.54it/s]Layer 18:  10%|▉         | 4/41 [00:01<00:11,  3.26it/s]Layer 18:  12%|█▏        | 5/41 [00:01<00:11,  3.12it/s]Layer 18:  15%|█▍        | 6/41 [00:01<00:11,  3.09it/s]Layer 18:  17%|█▋        | 7/41 [00:02<00:11,  3.08it/s]Layer 18:  20%|█▉        | 8/41 [00:02<00:10,  3.03it/s]Layer 18:  22%|██▏       | 9/41 [00:02<00:10,  3.03it/s]Layer 18:  24%|██▍       | 10/41 [00:03<00:10,  3.00it/s]Layer 18:  27%|██▋       | 11/41 [00:03<00:09,  3.01it/s]Layer 18:  29%|██▉       | 12/41 [00:03<00:10,  2.86it/s]Layer 18:  32%|███▏      | 13/41 [00:04<00:09,  2.91it/s]Layer 18:  34%|███▍      | 14/41 [00:04<00:09,  2.93it/s]Layer 18:  37%|███▋      | 15/41 [00:04<00:08,  2.92it/s]Layer 18:  39%|███▉      | 16/41 [00:05<00:08,  2.93it/s]Layer 18:  41%|████▏     | 17/41 [00:05<00:08,  2.95it/s]Layer 18:  44%|████▍     | 18/41 [00:05<00:07,  2.94it/s]Layer 18:  46%|████▋     | 19/41 [00:06<00:07,  2.98it/s]Layer 18:  49%|████▉     | 20/41 [00:06<00:07,  2.96it/s]Layer 18:  51%|█████     | 21/41 [00:06<00:06,  2.90it/s]Layer 18:  54%|█████▎    | 22/41 [00:07<00:06,  2.88it/s]Layer 18:  56%|█████▌    | 23/41 [00:07<00:06,  2.97it/s]Layer 18:  59%|█████▊    | 24/41 [00:07<00:05,  3.01it/s]Layer 18:  61%|██████    | 25/41 [00:08<00:05,  3.00it/s]Layer 18:  63%|██████▎   | 26/41 [00:08<00:05,  2.89it/s]Layer 18:  66%|██████▌   | 27/41 [00:09<00:05,  2.75it/s]Layer 18:  68%|██████▊   | 28/41 [00:09<00:04,  2.80it/s]Layer 18:  71%|███████   | 29/41 [00:09<00:04,  2.70it/s]Layer 18:  73%|███████▎  | 30/41 [00:10<00:04,  2.50it/s]Layer 18:  76%|███████▌  | 31/41 [00:10<00:03,  2.61it/s]Layer 18:  78%|███████▊  | 32/41 [00:10<00:03,  2.71it/s]Layer 18:  80%|████████  | 33/41 [00:11<00:02,  2.80it/s]Layer 18:  83%|████████▎ | 34/41 [00:11<00:02,  2.89it/s]Layer 18:  85%|████████▌ | 35/41 [00:11<00:02,  2.91it/s]Layer 18:  88%|████████▊ | 36/41 [00:12<00:01,  2.97it/s]Layer 18:  90%|█████████ | 37/41 [00:12<00:01,  2.96it/s]Layer 18:  93%|█████████▎| 38/41 [00:12<00:01,  2.95it/s]Layer 18:  95%|█████████▌| 39/41 [00:13<00:00,  2.94it/s]Layer 18:  98%|█████████▊| 40/41 [00:13<00:00,  2.95it/s]Layer 18: 100%|██████████| 41/41 [00:13<00:00,  2.85it/s]Layer 18: 100%|██████████| 41/41 [00:13<00:00,  2.94it/s]
  Vector norm: 3.8281

Extracting layer 20...
Layer 20:   0%|          | 0/41 [00:00<?, ?it/s]Layer 20:   2%|▏         | 1/41 [00:00<00:05,  7.45it/s]Layer 20:   5%|▍         | 2/41 [00:00<00:09,  4.04it/s]Layer 20:   7%|▋         | 3/41 [00:00<00:10,  3.50it/s]Layer 20:  10%|▉         | 4/41 [00:01<00:11,  3.23it/s]Layer 20:  12%|█▏        | 5/41 [00:01<00:11,  3.09it/s]Layer 20:  15%|█▍        | 6/41 [00:01<00:11,  3.06it/s]Layer 20:  17%|█▋        | 7/41 [00:02<00:11,  3.07it/s]Layer 20:  20%|█▉        | 8/41 [00:02<00:10,  3.02it/s]Layer 20:  22%|██▏       | 9/41 [00:02<00:10,  3.02it/s]Layer 20:  24%|██▍       | 10/41 [00:03<00:10,  3.00it/s]Layer 20:  27%|██▋       | 11/41 [00:03<00:10,  2.99it/s]Layer 20:  29%|██▉       | 12/41 [00:03<00:10,  2.85it/s]Layer 20:  32%|███▏      | 13/41 [00:04<00:09,  2.90it/s]Layer 20:  34%|███▍      | 14/41 [00:04<00:09,  2.94it/s]Layer 20:  37%|███▋      | 15/41 [00:04<00:08,  2.91it/s]Layer 20:  39%|███▉      | 16/41 [00:05<00:08,  2.91it/s]Layer 20:  41%|████▏     | 17/41 [00:05<00:08,  2.94it/s]Layer 20:  44%|████▍     | 18/41 [00:05<00:07,  2.94it/s]Layer 20:  46%|████▋     | 19/41 [00:06<00:07,  2.98it/s]Layer 20:  49%|████▉     | 20/41 [00:06<00:07,  2.97it/s]Layer 20:  51%|█████     | 21/41 [00:06<00:06,  2.91it/s]Layer 20:  54%|█████▎    | 22/41 [00:07<00:06,  2.92it/s]Layer 20:  56%|█████▌    | 23/41 [00:07<00:06,  2.99it/s]Layer 20:  59%|█████▊    | 24/41 [00:07<00:05,  3.02it/s]Layer 20:  61%|██████    | 25/41 [00:08<00:05,  3.02it/s]Layer 20:  63%|██████▎   | 26/41 [00:08<00:05,  2.90it/s]Layer 20:  66%|██████▌   | 27/41 [00:09<00:05,  2.75it/s]Layer 20:  68%|██████▊   | 28/41 [00:09<00:04,  2.79it/s]Layer 20:  71%|███████   | 29/41 [00:09<00:04,  2.70it/s]Layer 20:  73%|███████▎  | 30/41 [00:10<00:04,  2.51it/s]Layer 20:  76%|███████▌  | 31/41 [00:10<00:03,  2.63it/s]Layer 20:  78%|███████▊  | 32/41 [00:10<00:03,  2.71it/s]Layer 20:  80%|████████  | 33/41 [00:11<00:02,  2.81it/s]Layer 20:  83%|████████▎ | 34/41 [00:11<00:02,  2.90it/s]Layer 20:  85%|████████▌ | 35/41 [00:11<00:02,  2.92it/s]Layer 20:  88%|████████▊ | 36/41 [00:12<00:01,  2.98it/s]Layer 20:  90%|█████████ | 37/41 [00:12<00:01,  2.96it/s]Layer 20:  93%|█████████▎| 38/41 [00:12<00:01,  2.95it/s]Layer 20:  95%|█████████▌| 39/41 [00:13<00:00,  2.94it/s]Layer 20:  98%|█████████▊| 40/41 [00:13<00:00,  2.95it/s]Layer 20: 100%|██████████| 41/41 [00:13<00:00,  2.86it/s]Layer 20: 100%|██████████| 41/41 [00:13<00:00,  2.94it/s]
  Vector norm: 4.6562

Testing vector effectiveness...

Testing layer 14...

Testing layer 16...

Testing layer 18...

Testing layer 20...


     Tool_Restraint Detection Rates by Layer and Strength     
┏━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━┓
┃ Layer ┃ s=0.0 (base) ┃ s=0.5 ┃ s=1.0 ┃ s=1.5 ┃ Improvement ┃
┡━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━━┩
│ 14    │ 0%           │ 0%    │ 0%    │ 0%    │ +0%         │
│ 16    │ 0%           │ 0%    │ 0%    │ 0%    │ +0%         │
│ 18    │ 0%           │ 0%    │ 0%    │ 0%    │ +0%         │
│ 20    │ 0%           │ 0%    │ 0%    │ 0%    │ +0%         │
└───────┴──────────────┴───────┴───────┴───────┴─────────────┘

Best layer: None (improvement: +inf%)

Saving vectors to data/vectors/tool_restraint_mistral_7b_instruct_v0.2...
Done!

Example outputs with best vector (layer None):
Traceback (most recent call last):
  File "/Users/subhadipmitra/Dev/steering-vectors-agents/experiments/scripts/extract_behavior_vector.py", line 451, in <module>
    main()
  File "/Users/subhadipmitra/Dev/steering-vectors-agents/experiments/scripts/extract_behavior_vector.py", line 398, in main
    best_vector = vectors[best_layer]
                  ~~~~~~~^^^^^^^^^^^^
KeyError: None
